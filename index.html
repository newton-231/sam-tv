<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>SAMTV PRO - Ø§Ù„Ø®Ø§Øµ Ø¨ÙŠ</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --bg: #050505; --primary: #00aaff; --card: #151515; }
        * { box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #loginScreen { margin: auto; width: 90%; max-width: 350px; text-align: center; }
        input, button { width: 100%; padding: 16px; margin: 10px 0; border: none; border-radius: 12px; font-size: 16px; }
        input { background: #222; color: #fff; text-align: center; border: 1px solid #333; }
        button { background: var(--primary); color: #000; font-weight: bold; cursor: pointer; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        #appScreen { display: none; flex: 1; flex-direction: column; overflow: hidden; }
        header { background: #111; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        video { width: 100%; aspect-ratio: 16/9; background: #000; border-bottom: 2px solid var(--primary); }
        
        .scroll-area { flex: 1; overflow-y: auto; padding: 15px; }
        .section-title { font-size: 18px; margin: 20px 5px 10px; color: var(--primary); font-weight: bold; border-right: 4px solid var(--primary); padding-right: 10px; }
        .row { display: flex; overflow-x: auto; gap: 12px; padding-bottom: 15px; min-height: 120px; }
        
        /* Ø§Ù„ÙƒØ±ÙˆØª */
        .card { flex: 0 0 120px; background: var(--card); border-radius: 12px; text-align: center; overflow: hidden; border: 1px solid #222; cursor: pointer; }
        .card img { width: 100%; height: 160px; object-fit: cover; background: #222; }
        .card p { font-size: 11px; margin: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        #status { font-size: 12px; color: #ff453a; margin-top: 10px; }
    </style>
</head>
<body>

<div id="loginScreen">
    <h1 style="color:var(--primary); letter-spacing:1px;">SAMTV PRO</h1>
    <p style="color:#888; font-size:14px;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø« Ø¹Ø¨Ø± Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ø§Øµ</p>
    <input id="code" type="text" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„" value="477500438590">
    <button onclick="activate()">ØªÙØ¹ÙŠÙ„ ÙˆØ¯Ø®ÙˆÙ„</button>
    <p id="status"></p>
</div>

<div id="appScreen">
    <header>
        <span style="font-weight:bold; color:var(--primary)">SAMTV PRO</span>
        <button onclick="logout()" style="width:auto; padding:6px 15px; font-size:12px; background:#ff453a; color:#fff; margin:0;">Ø®Ø±ÙˆØ¬</button>
    </header>
    
    <video id="player" controls autoplay playsinline></video>
    
    <div class="scroll-area">
        <div class="section-title">ğŸ“º Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</div>
        <div id="liveRow" class="row"></div>
        
        <div class="section-title">ğŸ¬ Ø§Ù„Ø£ÙÙ„Ø§Ù…</div>
        <div id="moviesRow" class="row"></div>
        
        <div class="section-title">ğŸ­ Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</div>
        <div id="seriesRow" class="row"></div>
    </div>
</div>

<script>
// Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
const WORKER_URL = "https://sam-tv.ishaak231.workers.dev";
const KEY = "dFU9bkEXX65K2C";

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´ÙÙŠØ± (XOR) Ù„Ø¶Ù…Ø§Ù† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„Ø·Ù„Ø¨
function xorEncrypt(data) {
    return btoa(data.split('').map((c, i) => 
        String.fromCharCode(c.charCodeAt(0) ^ KEY.charCodeAt(i % KEY.length))
    ).join(''));
}

// Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… (Worker)
async function apiRequest(action) {
    const code = localStorage.getItem("u_code");
    const payload = xorEncrypt(JSON.stringify({ code: code, action: action }));
    
    try {
        const response = await fetch(WORKER_URL, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "json=" + encodeURIComponent(payload)
        });
        return await response.json();
    } catch (err) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…:", err);
        return null;
    }
}

// ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„
async function activate() {
    const codeInput = document.getElementById("code").value.trim();
    if (!codeInput) return;
    
    document.getElementById("status").style.color = "var(--primary)";
    document.getElementById("status").innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø®Ø§Øµ...";
    
    localStorage.setItem("u_code", codeInput);
    
    try {
        const data = await apiRequest("login");
        if (data && data.status) {
            localStorage.setItem("app_ok", "1");
            showApp();
        } else {
            document.getElementById("status").style.color = "#ff453a";
            document.getElementById("status").innerText = "ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­";
        }
    } catch (e) {
        document.getElementById("status").innerText = "ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯";
    }
}

// Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¬Ù„Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
async function showApp() {
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("appScreen").style.display = "flex";
    
    // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø«Ù„Ø§Ø«Ø© ÙÙŠ ÙˆÙ‚Øª ÙˆØ§Ø­Ø¯
    loadSection("get_live", "liveRow");
    loadSection("get_movies", "moviesRow");
    loadSection("get_series", "seriesRow");
}

async function loadSection(action, rowId) {
    const data = await apiRequest(action);
    const container = document.getElementById(rowId);
    
    if (data && data.list && data.list.length > 0) {
        container.innerHTML = data.list.map(item => `
            <div class="card" onclick="playStream('${item.url}')">
                <img src="${item.logo || item.image || ''}" onerror="this.src='https://via.placeholder.com/120x160/222/fff?text=TV'">
                <p>${item.name}</p>
            </div>
        `).join('');
    } else {
        container.innerHTML = "<p style='padding:20px; color:#666;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</p>";
    }
}

// Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
function playStream(url) {
    const video = document.getElementById("player");
    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
    } else {
        video.src = url;
    }
    video.play();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
    localStorage.clear();
    location.reload();
}

// ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
if (localStorage.getItem("app_ok") === "1") {
    showApp();
}
</script>
</body>
</html>
