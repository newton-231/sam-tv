<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>SAMTV PRO</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10"></script>
    
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system, sans-serif; }
        body { background:#000; color:#fff; height:100vh; }
        
        #loginScreen { display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; padding:20px; }
        .logo { font-size:40px; color:#0af; margin-bottom:30px; }
        .input-box { width:90%; max-width:320px; margin-bottom:20px; }
        input { width:100%; padding:15px; background:#1c1c1e; color:#fff; border:none; border-radius:10px; font-size:16px; text-align:center; }
        .login-btn { width:90%; max-width:320px; padding:15px; background:#0af; color:#000; border:none; border-radius:10px; font-size:16px; font-weight:bold; }
        
        #appScreen { display:none; height:100vh; }
        .header { background:#1c1c1e; padding:15px; display:flex; justify-content:space-between; align-items:center; }
        .channels { display:flex; overflow-x:auto; gap:10px; padding:10px; }
        .channel { width:140px; background:#1c1c1e; border-radius:10px; overflow:hidden; }
        .channel img { width:100%; height:150px; object-fit:cover; }
        video { width:100%; height:250px; background:#000; display:none; }
        
        .error { color:#ff3b30; text-align:center; padding:20px; }
        .success { color:#0a4; text-align:center; padding:20px; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="logo">ğŸ“º SAMTV</div>
    <div class="input-box">
        <input id="code" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„" value="29319bd15409c675dc2c942946ff972e9a254c43">
    </div>
    <button class="login-btn" onclick="login()">ØªÙØ¹ÙŠÙ„</button>
    <div id="status" style="margin-top:15px; color:#888; font-size:14px;"></div>
</div>

<div id="appScreen">
    <div class="header">
        <div>SAMTV PRO</div>
        <button onclick="logout()" style="background:#ff3b30; color:#fff; padding:8px 15px; border-radius:8px;">Ø®Ø±ÙˆØ¬</button>
    </div>
    <video id="player" controls playsinline></video>
    <div id="content"></div>
</div>

<script>
// Ø¯Ø§Ù„Ø© ØªØ´ÙÙŠØ± XOR
function xorEncrypt(data) {
    const XOR_KEY = "123456";
    return btoa(data.split('').map((c, i) =>
        String.fromCharCode(c.charCodeAt(0) ^ XOR_KEY.charCodeAt(i % XOR_KEY.length))
    ).join(''));
}

async function login() {
    const code = document.getElementById("code").value.trim();
    if(!code) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯");
    
    const status = document.getElementById("status");
    status.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...";
    status.style.color = "#0af";
    
    try {
        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ù…ØªØµÙØ­ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const requestData = { code: code, action: "get_live" };
        const encrypted = xorEncrypt(JSON.stringify(requestData));
        
        const response = await fetch('https://samtv4norm.d1d2.org/login.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'User-Agent': 'SAMTVPro/5.3 (Android; IPTV)',
                'X-Requested-With': 'com.samtv.app',
                'Connection': 'Keep-Alive',
                'Accept-Encoding': 'gzip'
            },
            body: `json=${encodeURIComponent(encrypted)}`
        });
        
        const result = await response.json();
        
        if(result.status === "success") {
            localStorage.setItem("samtv_code", code);
            localStorage.setItem("samtv_channels", JSON.stringify(result.list || []));
            
            document.getElementById("loginScreen").style.display = "none";
            document.getElementById("appScreen").style.display = "block";
            
            displayChannels(result.list || []);
            
            status.textContent = "âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„!";
            status.style.color = "#0a4";
            
            // Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
            setTimeout(() => {
                if(navigator.userAgent.includes('iPhone')) {
                    alert("ğŸ“± Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª:\n1. Ø§Ù†Ù‚Ø± Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©\n2. Ø§Ø®ØªØ± 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'\n3. Ø§Ù†Ù‚Ø± 'Ø¥Ø¶Ø§ÙØ©'");
                }
            }, 1000);
            
        } else {
            status.textContent = "âŒ " + (result.message || "ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­");
            status.style.color = "#ff3b30";
        }
        
    } catch(error) {
        status.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: " + error.message;
        status.style.color = "#ff3b30";
        console.error("Error:", error);
    }
}

function displayChannels(channels) {
    const content = document.getElementById("content");
    
    if(!channels || channels.length === 0) {
        content.innerHTML = '<div class="error">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª</div>';
        return;
    }
    
    let html = '<div class="channels">';
    
    channels.forEach(ch => {
        html += `
            <div class="channel" onclick="playChannel('${ch.url}')">
                <img src="${ch.logo || ''}" 
                     onerror="this.src='https://via.placeholder.com/140x150/333/fff?text=${ch.name.substring(0,10)}'">
                <div style="padding:10px; text-align:center">${ch.name}</div>
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
}

function playChannel(url) {
    const player = document.getElementById("player");
    player.style.display = "block";
    
    if(Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(player);
        player.play();
    } else if(player.canPlayType('application/vnd.apple.mpegurl')) {
        player.src = url;
        player.play();
    }
}

function logout() {
    if(confirm("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
        localStorage.clear();
        location.reload();
    }
}

// Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØ¹Ù„
if(localStorage.getItem("samtv_code")) {
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("appScreen").style.display = "block";
    
    const channels = JSON.parse(localStorage.getItem("samtv_channels") || "[]");
    displayChannels(channels);
}
</script>
</body>
</html>
